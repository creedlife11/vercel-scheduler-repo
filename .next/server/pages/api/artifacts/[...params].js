"use strict";(()=>{var e={};e.id=97,e.ids=[97],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6801:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>m,routeModule:()=>h});var a={};r.r(a),r.d(a,{default:()=>d});var s=r(1802),o=r(7153),n=r(6249);let i=require("next-auth/next");var u=r(6848);async function d(e,t){let r=await (0,i.getServerSession)(e,t,u.authOptions);if(!r?.user)return t.status(401).json({error:"Authentication required"});let{params:a}=e.query,[s,...o]=Array.isArray(a)?a:[a];try{switch(s){case"list":return l(e,t,r.user);case"get":if(!o[0])return t.status(400).json({error:"Artifact ID required"});return c(e,t,r.user,o[0]);case"delete":if(!o[0])return t.status(400).json({error:"Artifact ID required"});return f(e,t,r.user,o[0]);default:return t.status(404).json({error:"Endpoint not found"})}}catch(e){return console.error("Artifacts API error:",e),t.status(500).json({error:"Internal server error"})}}async function l(e,t,r){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let a=e.query.team_id||r.teams?.[0]?.id;if(!a)return t.status(400).json({error:"Team ID required"});if(!("ADMIN"===r.role||r.teams?.some(e=>e.id===a)))return t.status(403).json({error:"Team access denied"});try{let e=await fetch(`${process.env.NEXTAUTH_URL}/api/team-storage/list`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:a,limit:50})});if(!e.ok)throw Error("Failed to fetch artifacts");let r=await e.json();return t.status(200).json(r)}catch(e){return t.status(500).json({error:"Failed to list artifacts"})}}async function c(e,t,r,a){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});if(!a)return t.status(400).json({error:"Artifact ID required"});let s=e.query.team_id||r.teams?.[0]?.id;if(!s)return t.status(400).json({error:"Team ID required"});if(!("ADMIN"===r.role||r.teams?.some(e=>e.id===s)))return t.status(403).json({error:"Team access denied"});try{let e=await fetch(`${process.env.NEXTAUTH_URL}/api/team-storage/get`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:s,artifact_id:a})});if(!e.ok){if(404===e.status)return t.status(404).json({error:"Artifact not found"});throw Error("Failed to fetch artifact")}let r=await e.arrayBuffer(),o=e.headers.get("content-type")||"application/octet-stream",n=e.headers.get("content-disposition")?.match(/filename="([^"]+)"/)?.[1]||"artifact";return t.setHeader("Content-Type",o),t.setHeader("Content-Disposition",`attachment; filename="${n}"`),t.status(200).send(Buffer.from(r))}catch(e){return t.status(500).json({error:"Failed to get artifact"})}}async function f(e,t,r,a){if("DELETE"!==e.method)return t.status(405).json({error:"Method not allowed"});if(!["EDITOR","ADMIN"].includes(r.role))return t.status(403).json({error:"Insufficient permissions"});if(!a)return t.status(400).json({error:"Artifact ID required"});let s=e.query.team_id||r.teams?.[0]?.id;if(!s)return t.status(400).json({error:"Team ID required"});if(!("ADMIN"===r.role||r.teams?.some(e=>e.id===s)))return t.status(403).json({error:"Team access denied"});try{let e=await fetch(`${process.env.NEXTAUTH_URL}/api/team-storage/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:s,artifact_id:a,user_id:r.id})});if(!e.ok){if(404===e.status)return t.status(404).json({error:"Artifact not found"});throw Error("Failed to delete artifact")}return t.status(200).json({success:!0})}catch(e){return t.status(500).json({error:"Failed to delete artifact"})}}let m=(0,n.l)(a,"default"),p=(0,n.l)(a,"config"),h=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/artifacts/[...params]",pathname:"/api/artifacts/[...params]",bundlePath:"",filename:""},userland:a})},6848:(e,t,r)=>{r.r(t),r.d(t,{authOptions:()=>n,default:()=>i});let a=require("next-auth");var s=r.n(a);let o=require("next-auth/providers/credentials"),n={providers:[r.n(o)()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=[{id:"1",email:"demo@example.com",password:"demo123",name:"Demo User",role:"ADMIN"},{id:"2",email:"editor@example.com",password:"editor123",name:"Editor User",role:"EDITOR"},{id:"3",email:"user@example.com",password:"user123",name:"Regular User",role:"VIEWER"}].find(t=>t.email===e.email&&t.password===e.password);return t?{id:t.id,email:t.email,name:t.name,role:t.role,teams:[{id:"team-1",name:"Default Team",role:t.role}]}:null}})],session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.teams=t.teams),e),session:async({session:e,token:t})=>(t&&e.user&&(e.user.id=t.sub,e.user.role=t.role,e.user.teams=t.teams),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},debug:!1},i=s()(n)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6801);module.exports=r})();