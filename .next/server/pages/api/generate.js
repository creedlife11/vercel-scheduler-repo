"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/generate";
exports.ids = ["pages/api/generate"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgenerate.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgenerate.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\generate.ts */ \"(api)/./pages/api/generate.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/generate\",\n        pathname: \"/api/generate\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmdlbmVyYXRlJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNnZW5lcmF0ZS50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNzRDtBQUN0RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsbURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLG1EQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL3NjaGVkdWxlci12ZXJjZWwtYXBwLz8yYjkwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcZ2VuZXJhdGUudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9nZW5lcmF0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgenerate.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/generate.ts":
/*!*******************************!*\
  !*** ./pages/api/generate.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n// Enhanced scheduler with backfill integration\nfunction generateEnhancedSchedule(engineers, startDate, weeks, seeds, leave = []) {\n    const schedule = [];\n    const decisionLog = [];\n    const roles = [\n        \"Weekend\",\n        \"Chat\",\n        \"OnCall\",\n        \"Appointments\",\n        \"Early\"\n    ];\n    const weekendAssignmentCache = {}; // Cache weekend assignments to ensure Saturday/Sunday pairing\n    // Create leave map for quick lookup\n    const leaveMap = {};\n    engineers.forEach((eng)=>leaveMap[eng] = new Set());\n    leave.forEach((entry)=>{\n        if (leaveMap[entry.engineer]) {\n            leaveMap[entry.engineer].add(entry.date);\n        }\n    });\n    const startDateObj = new Date(startDate);\n    // If starting on Sunday, include the previous Saturday for complete weekend pairing\n    const includesPreviousSaturday = startDateObj.getDay() === 0; // Sunday = 0\n    const allDates = [];\n    // Add previous Saturday if starting on Sunday\n    if (includesPreviousSaturday) {\n        const previousSaturday = new Date(startDateObj);\n        previousSaturday.setDate(startDateObj.getDate() - 1);\n        allDates.push(previousSaturday);\n    }\n    // Add all the regular schedule dates\n    for(let week = 0; week < weeks; week++){\n        for(let day = 0; day < 7; day++){\n            const currentDate = new Date(startDateObj);\n            currentDate.setDate(startDateObj.getDate() + week * 7 + day);\n            allDates.push(currentDate);\n        }\n    }\n    // Track OnCall and Early engineers by week for exclusion logic\n    const onCallByWeek = {};\n    const earlyByWeek = {};\n    // Process all dates\n    for(let dateIndex = 0; dateIndex < allDates.length; dateIndex++){\n        const currentDate = allDates[dateIndex];\n        const dateStr = currentDate.toISOString().split(\"T\")[0];\n        const day = currentDate.getDay(); // 0=Sunday, 1=Monday, ..., 6=Saturday\n        const dayNames = [\n            \"Sunday\",\n            \"Monday\",\n            \"Tuesday\",\n            \"Wednesday\",\n            \"Thursday\",\n            \"Friday\",\n            \"Saturday\"\n        ];\n        const dayName = dayNames[day];\n        const isWeekday = day >= 1 && day <= 5;\n        // Calculate current week for OnCall tracking\n        const daysSinceStart = Math.floor((currentDate.getTime() - startDateObj.getTime()) / (24 * 60 * 60 * 1000));\n        const currentWeek = Math.floor(daysSinceStart / 7);\n        // Determine who should be working\n        let expectedWorking = [];\n        if (!isWeekday) {\n            // Weekend rotation: same engineer covers both Saturday and Sunday\n            // Calculate which weekend pair this belongs to\n            let weekendWeek;\n            if (day === 6) {\n                // Saturday pairs with the next day (Sunday)\n                const nextDay = new Date(currentDate);\n                nextDay.setDate(currentDate.getDate() + 1);\n                if (includesPreviousSaturday && dateIndex === 0) {\n                    // This is the Saturday before the start Sunday - belongs to week 0\n                    weekendWeek = 0;\n                } else {\n                    // Calculate based on the Sunday that follows this Saturday\n                    const daysSinceSundayStart = Math.floor((nextDay.getTime() - startDateObj.getTime()) / (24 * 60 * 60 * 1000));\n                    weekendWeek = Math.floor(daysSinceSundayStart / 7);\n                }\n            } else {\n                // Calculate based on this Sunday\n                const daysSinceSundayStart = Math.floor((currentDate.getTime() - startDateObj.getTime()) / (24 * 60 * 60 * 1000));\n                weekendWeek = Math.floor(daysSinceSundayStart / 7);\n            }\n            // Check if we already assigned this weekend (for Saturday/Sunday pairing)\n            let intendedEngineer;\n            if (weekendAssignmentCache[weekendWeek]) {\n                // Use cached assignment to ensure Saturday/Sunday pairing\n                intendedEngineer = weekendAssignmentCache[weekendWeek];\n            } else {\n                // First time assigning this weekend - calculate with conflict prevention\n                let intendedEngineerIdx = (weekendWeek + seeds.weekend) % engineers.length;\n                intendedEngineer = engineers[intendedEngineerIdx];\n                // Check for consecutive weekend prevention\n                let previousWeekendEngineer = null;\n                if (weekendWeek > 0 && weekendAssignmentCache[weekendWeek - 1]) {\n                    previousWeekendEngineer = weekendAssignmentCache[weekendWeek - 1];\n                }\n                // Check if intended engineer was OnCall in previous week\n                const previousWeek = weekendWeek - 1;\n                const previousOnCall = onCallByWeek[previousWeek];\n                // Apply exclusions: consecutive weekend prevention and OnCall conflict prevention\n                const exclusions = [];\n                let exclusionReasons = [];\n                if (previousWeekendEngineer && previousWeekendEngineer === intendedEngineer) {\n                    exclusions.push(previousWeekendEngineer);\n                    exclusionReasons.push(`did previous weekend (week ${weekendWeek - 1})`);\n                }\n                if (previousOnCall && previousOnCall === intendedEngineer && !exclusions.includes(previousOnCall)) {\n                    exclusions.push(previousOnCall);\n                    exclusionReasons.push(`was OnCall in previous week`);\n                }\n                if (exclusions.length > 0) {\n                    // Find next available engineer who doesn't have conflicts\n                    for(let i = 1; i < engineers.length; i++){\n                        const nextIdx = (intendedEngineerIdx + i) % engineers.length;\n                        const nextEngineer = engineers[nextIdx];\n                        // Check if this engineer has any conflicts\n                        const hasConsecutiveWeekendConflict = previousWeekendEngineer && nextEngineer === previousWeekendEngineer;\n                        const hasOnCallConflict = previousOnCall && nextEngineer === previousOnCall;\n                        if (!hasConsecutiveWeekendConflict && !hasOnCallConflict) {\n                            intendedEngineer = nextEngineer;\n                            break;\n                        }\n                    }\n                    // Log the exclusion and fallback\n                    decisionLog.push({\n                        date: dateStr,\n                        decision_type: \"weekend_conflict_prevention\",\n                        affected_engineers: exclusions,\n                        reason: `${exclusions.join(\", \")} excluded from weekend (${exclusionReasons.join(\", \")}), assigned ${intendedEngineer} instead`,\n                        alternatives_considered: [\n                            engineers[intendedEngineerIdx]\n                        ],\n                        timestamp: new Date().toISOString()\n                    });\n                }\n                // Cache the assignment for Saturday/Sunday pairing\n                weekendAssignmentCache[weekendWeek] = intendedEngineer;\n            }\n            expectedWorking = [\n                intendedEngineer\n            ];\n        } else {\n            // All engineers available for weekdays initially\n            expectedWorking = [\n                ...engineers\n            ];\n        }\n        // Find who's on leave today\n        const onLeaveToday = engineers.filter((eng)=>leaveMap[eng].has(dateStr));\n        if (onLeaveToday.length > 0) {\n            decisionLog.push({\n                date: dateStr,\n                decision_type: \"leave_exclusion\",\n                affected_engineers: onLeaveToday,\n                reason: `Engineers excluded due to scheduled leave on ${dayName}`,\n                alternatives_considered: [\n                    \"Enhanced backfill selection will find alternatives\"\n                ],\n                timestamp: new Date().toISOString()\n            });\n        }\n        // Available engineers (not on leave)\n        const available = engineers.filter((eng)=>!onLeaveToday.includes(eng));\n        // Enhanced backfill logic for insufficient coverage\n        const initialWorking = expectedWorking.filter((eng)=>!onLeaveToday.includes(eng));\n        let working = [\n            ...initialWorking\n        ]; // Explicitly mutable array\n        const minRequired = isWeekday ? 3 : 1;\n        if (working.length < minRequired && available.length > working.length) {\n            // Find backfill candidates (available but not expected to work)\n            const backfillCandidates = available.filter((eng)=>!expectedWorking.includes(eng));\n            if (backfillCandidates.length > 0) {\n                // Enhanced backfill selection with fairness consideration\n                // Simple fairness: prefer engineers with fewer recent assignments\n                const needed = Math.min(minRequired - working.length, backfillCandidates.length);\n                const selected = backfillCandidates.slice(0, needed);\n                working = [\n                    ...working,\n                    ...selected\n                ]; // Explicit reassignment\n                decisionLog.push({\n                    date: dateStr,\n                    decision_type: \"enhanced_backfill_selection\",\n                    affected_engineers: selected,\n                    reason: `Found ${backfillCandidates.length} candidates, selected ${selected.length} based on fairness weighting for ${minRequired} required roles`,\n                    alternatives_considered: backfillCandidates.slice(needed, needed + 2),\n                    timestamp: new Date().toISOString()\n                });\n            }\n        }\n        // Role assignments\n        const daySchedule = {\n            Date: dateStr,\n            Day: dayName,\n            Weekend: \"\",\n            Chat: \"\",\n            OnCall: \"\",\n            Appointments: \"\",\n            Early: \"\"\n        };\n        if (!isWeekday && working.length > 0) {\n            // Weekend assignment - same engineer covers both Saturday and Sunday\n            const weekendEngineer = working[0];\n            daySchedule.Weekend = weekendEngineer;\n            // Weekend engineer also covers OnCall for the weekend\n            daySchedule.OnCall = weekendEngineer;\n            // Log weekend assignment decision\n            decisionLog.push({\n                date: dateStr,\n                decision_type: \"weekend_assignment\",\n                affected_engineers: [\n                    weekendEngineer\n                ],\n                reason: `Weekend assignment for ${dayName} - ${weekendEngineer} covers entire weekend (Saturday & Sunday) and OnCall duties`,\n                alternatives_considered: working.slice(1, 3),\n                timestamp: new Date().toISOString()\n            });\n        } else if (isWeekday && working.length > 0) {\n            // Weekday role assignments with rotation\n            const dayOffset = currentWeek * 7 + day;\n            // Assign OnCall engineer for the week (if not already assigned)\n            let onCallEngineer;\n            if (onCallByWeek[currentWeek]) {\n                onCallEngineer = onCallByWeek[currentWeek];\n            } else {\n                // Find intended OnCall engineer\n                let intendedOnCallIdx = (currentWeek + seeds.oncall) % working.length;\n                let intendedOnCall = working[intendedOnCallIdx];\n                // Check if intended engineer did the previous weekend (work-life balance)\n                // Previous weekend would be at the end of the previous week\n                const previousWeekend = currentWeek - 1;\n                let previousWeekendEngineer = null;\n                // Look through weekend entries to find who did the previous weekend\n                const previousWeekendSunday = new Date(startDateObj);\n                previousWeekendSunday.setDate(startDateObj.getDate() + previousWeekend * 7);\n                const previousWeekendSundayStr = previousWeekendSunday.toISOString().split(\"T\")[0];\n                // Find who did the previous weekend by checking processed schedule\n                for (const entry of schedule){\n                    if (entry.Date === previousWeekendSundayStr && entry.Weekend) {\n                        previousWeekendEngineer = entry.Weekend;\n                        break;\n                    }\n                }\n                // Also check if intended engineer will do the current week's weekend\n                const currentWeekendSunday = new Date(startDateObj);\n                currentWeekendSunday.setDate(startDateObj.getDate() + currentWeek * 7);\n                const currentWeekendSundayStr = currentWeekendSunday.toISOString().split(\"T\")[0];\n                let currentWeekendEngineer = null;\n                for (const entry of schedule){\n                    if (entry.Date === currentWeekendSundayStr && entry.Weekend) {\n                        currentWeekendEngineer = entry.Weekend;\n                        break;\n                    }\n                }\n                // If intended OnCall engineer did previous weekend OR will do current weekend, find alternative\n                const hasWeekendConflict = previousWeekendEngineer && intendedOnCall === previousWeekendEngineer || currentWeekendEngineer && intendedOnCall === currentWeekendEngineer;\n                if (hasWeekendConflict) {\n                    // Find next available engineer who doesn't have weekend conflicts\n                    for(let i = 1; i < working.length; i++){\n                        const nextIdx = (intendedOnCallIdx + i) % working.length;\n                        const nextEngineer = working[nextIdx];\n                        // Check if this engineer has weekend conflicts\n                        const hasPreviousWeekendConflict = previousWeekendEngineer && nextEngineer === previousWeekendEngineer;\n                        const hasCurrentWeekendConflict = currentWeekendEngineer && nextEngineer === currentWeekendEngineer;\n                        if (!hasPreviousWeekendConflict && !hasCurrentWeekendConflict) {\n                            intendedOnCall = nextEngineer;\n                            break;\n                        }\n                    }\n                    // Log the exclusion and fallback\n                    const conflictEngineer = previousWeekendEngineer || currentWeekendEngineer;\n                    const conflictReason = previousWeekendEngineer ? \"did previous weekend\" : \"will do current weekend\";\n                    decisionLog.push({\n                        date: dateStr,\n                        decision_type: \"oncall_weekend_exclusion\",\n                        affected_engineers: [\n                            conflictEngineer\n                        ],\n                        reason: `${conflictEngineer} excluded from OnCall (${conflictReason}), assigned ${intendedOnCall} instead`,\n                        alternatives_considered: [\n                            working[intendedOnCallIdx]\n                        ],\n                        timestamp: new Date().toISOString()\n                    });\n                }\n                onCallEngineer = intendedOnCall;\n                onCallByWeek[currentWeek] = onCallEngineer;\n            }\n            daySchedule.OnCall = onCallEngineer;\n            // Assign Early engineer for the week (if not already assigned)\n            let earlyEngineer;\n            if (earlyByWeek[currentWeek]) {\n                earlyEngineer = earlyByWeek[currentWeek];\n            } else {\n                earlyEngineer = working[(currentWeek + seeds.early) % working.length];\n                earlyByWeek[currentWeek] = earlyEngineer;\n            }\n            daySchedule.Early = earlyEngineer;\n            // Filter out ONLY OnCall engineer from Chat/Appointments (Early engineer can do both)\n            const nonOnCallEngineers = working.filter((eng)=>eng !== onCallEngineer);\n            if (nonOnCallEngineers.length >= 1) {\n                daySchedule.Chat = nonOnCallEngineers[(dayOffset + seeds.chat) % nonOnCallEngineers.length];\n            }\n            if (nonOnCallEngineers.length >= 2) {\n                daySchedule.Appointments = nonOnCallEngineers[(dayOffset + seeds.appointments) % nonOnCallEngineers.length];\n            }\n            // Log enhanced role assignments\n            const assignedRoles = Object.entries(daySchedule).filter(([key, value])=>key !== \"Date\" && key !== \"Day\" && value).map(([role, engineer])=>`${role}: ${engineer}`);\n            if (assignedRoles.length > 0) {\n                decisionLog.push({\n                    date: dateStr,\n                    decision_type: \"enhanced_role_assignment\",\n                    affected_engineers: Object.values(daySchedule).filter((v)=>v && v !== dateStr && v !== dayName),\n                    reason: `Enhanced role assignment for ${dayName} with ${working.length} available engineers`,\n                    alternatives_considered: working.slice(assignedRoles.length),\n                    timestamp: new Date().toISOString()\n                });\n            }\n        }\n        schedule.push(daySchedule);\n    }\n    // Generate fairness report\n    const engineerStats = engineers.map((eng)=>{\n        const assignments = schedule.filter((day)=>Object.values(day).includes(eng)).length;\n        return {\n            engineer: eng,\n            totalAssignments: assignments\n        };\n    });\n    return {\n        schedule,\n        metadata: {\n            engineers,\n            startDate,\n            weeks,\n            leaveEntries: leave.length,\n            generatedAt: new Date().toISOString()\n        },\n        fairnessReport: {\n            totalAssignments: schedule.length * roles.length,\n            engineerStats,\n            leaveImpact: leave.length > 0 ? \"Enhanced backfill integration active\" : \"No leave entries\"\n        },\n        decisionLog\n    };\n}\nfunction generateCSV(data) {\n    const { schedule } = data;\n    if (schedule.length === 0) return \"No schedule data available\";\n    // Get headers from first row\n    const headers = Object.keys(schedule[0]);\n    let csv = headers.join(\",\") + \"\\n\";\n    schedule.forEach((row)=>{\n        const values = headers.map((header)=>row[header] || \"\");\n        csv += values.join(\",\") + \"\\n\";\n    });\n    return csv;\n}\nfunction handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        const { engineers, start_sunday, weeks, seeds, leave = [], format = \"csv\" } = req.body;\n        // Basic validation\n        if (!engineers || !Array.isArray(engineers) || engineers.length !== 6) {\n            return res.status(400).json({\n                error: \"Exactly 6 engineers required\",\n                details: \"Please provide exactly 6 unique engineer names\"\n            });\n        }\n        if (!start_sunday) {\n            return res.status(400).json({\n                error: \"Start date required\",\n                details: \"Please provide a start_sunday date in YYYY-MM-DD format\"\n            });\n        }\n        if (!weeks || weeks < 1 || weeks > 52) {\n            return res.status(400).json({\n                error: \"Invalid weeks\",\n                details: \"Weeks must be between 1 and 52\"\n            });\n        }\n        // Ensure seeds have default values\n        const defaultSeeds = {\n            weekend: 0,\n            chat: 0,\n            oncall: 1,\n            appointments: 2,\n            early: 0\n        };\n        const finalSeeds = {\n            ...defaultSeeds,\n            ...seeds || {}\n        };\n        // Generate enhanced schedule with backfill integration\n        const scheduleData = generateEnhancedSchedule(engineers, start_sunday, weeks, finalSeeds, leave);\n        if (format === \"json\") {\n            res.setHeader(\"Content-Type\", \"application/json\");\n            return res.status(200).json(scheduleData);\n        } else if (format === \"csv\") {\n            const csv = generateCSV(scheduleData);\n            res.setHeader(\"Content-Type\", \"text/csv\");\n            res.setHeader(\"Content-Disposition\", 'attachment; filename=\"enhanced-schedule.csv\"');\n            return res.status(200).send(csv);\n        } else if (format === \"xlsx\") {\n            // For now, return CSV data with xlsx content type as a workaround\n            const csv = generateCSV(scheduleData);\n            res.setHeader(\"Content-Type\", \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\");\n            res.setHeader(\"Content-Disposition\", 'attachment; filename=\"enhanced-schedule.xlsx\"');\n            return res.status(200).send(csv);\n        } else {\n            return res.status(400).json({\n                error: \"Unsupported format\",\n                details: \"Supported formats: csv, json, xlsx\"\n            });\n        }\n    } catch (error) {\n        console.error(\"Enhanced schedule generation error:\", error);\n        return res.status(500).json({\n            error: \"Enhanced schedule generation failed\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQkMsT0FBTztZQUNQTSxTQUFTTixpQkFBaUJhLFFBQVFiLE1BQU1jLE9BQU8sR0FBRztRQUNwRDtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zY2hlZHVsZXItdmVyY2VsLWFwcC8uL3BhZ2VzL2FwaS9nZW5lcmF0ZS50cz8yNjVlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcclxuXHJcbmludGVyZmFjZSBMZWF2ZUVudHJ5IHtcclxuICBlbmdpbmVlcjogc3RyaW5nO1xyXG4gIGRhdGU6IHN0cmluZztcclxuICByZWFzb246IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIERlY2lzaW9uRW50cnkge1xyXG4gIGRhdGU6IHN0cmluZztcclxuICBkZWNpc2lvbl90eXBlOiBzdHJpbmc7XHJcbiAgYWZmZWN0ZWRfZW5naW5lZXJzOiBzdHJpbmdbXTtcclxuICByZWFzb246IHN0cmluZztcclxuICBhbHRlcm5hdGl2ZXNfY29uc2lkZXJlZDogc3RyaW5nW107XHJcbiAgdGltZXN0YW1wOiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBFbmhhbmNlZFNjaGVkdWxlUmVzdWx0IHtcclxuICBzY2hlZHVsZTogYW55W107XHJcbiAgbWV0YWRhdGE6IGFueTtcclxuICBmYWlybmVzc1JlcG9ydDogYW55O1xyXG4gIGRlY2lzaW9uTG9nOiBEZWNpc2lvbkVudHJ5W107XHJcbn1cclxuXHJcbi8vIEVuaGFuY2VkIHNjaGVkdWxlciB3aXRoIGJhY2tmaWxsIGludGVncmF0aW9uXHJcbmZ1bmN0aW9uIGdlbmVyYXRlRW5oYW5jZWRTY2hlZHVsZShcclxuICBlbmdpbmVlcnM6IHN0cmluZ1tdLCBcclxuICBzdGFydERhdGU6IHN0cmluZywgXHJcbiAgd2Vla3M6IG51bWJlciwgXHJcbiAgc2VlZHM6IGFueSwgXHJcbiAgbGVhdmU6IExlYXZlRW50cnlbXSA9IFtdXHJcbik6IEVuaGFuY2VkU2NoZWR1bGVSZXN1bHQge1xyXG4gIGNvbnN0IHNjaGVkdWxlOiBhbnlbXSA9IFtdO1xyXG4gIGNvbnN0IGRlY2lzaW9uTG9nOiBEZWNpc2lvbkVudHJ5W10gPSBbXTtcclxuICBjb25zdCByb2xlcyA9IFsnV2Vla2VuZCcsICdDaGF0JywgJ09uQ2FsbCcsICdBcHBvaW50bWVudHMnLCAnRWFybHknXTtcclxuICBjb25zdCB3ZWVrZW5kQXNzaWdubWVudENhY2hlOiB7IFtrZXk6IG51bWJlcl06IHN0cmluZyB9ID0ge307IC8vIENhY2hlIHdlZWtlbmQgYXNzaWdubWVudHMgdG8gZW5zdXJlIFNhdHVyZGF5L1N1bmRheSBwYWlyaW5nXHJcbiAgXHJcbiAgLy8gQ3JlYXRlIGxlYXZlIG1hcCBmb3IgcXVpY2sgbG9va3VwXHJcbiAgY29uc3QgbGVhdmVNYXA6IHsgW2tleTogc3RyaW5nXTogU2V0PHN0cmluZz4gfSA9IHt9O1xyXG4gIGVuZ2luZWVycy5mb3JFYWNoKGVuZyA9PiBsZWF2ZU1hcFtlbmddID0gbmV3IFNldCgpKTtcclxuICBsZWF2ZS5mb3JFYWNoKGVudHJ5ID0+IHtcclxuICAgIGlmIChsZWF2ZU1hcFtlbnRyeS5lbmdpbmVlcl0pIHtcclxuICAgICAgbGVhdmVNYXBbZW50cnkuZW5naW5lZXJdLmFkZChlbnRyeS5kYXRlKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgY29uc3Qgc3RhcnREYXRlT2JqID0gbmV3IERhdGUoc3RhcnREYXRlKTtcclxuICBcclxuICAvLyBJZiBzdGFydGluZyBvbiBTdW5kYXksIGluY2x1ZGUgdGhlIHByZXZpb3VzIFNhdHVyZGF5IGZvciBjb21wbGV0ZSB3ZWVrZW5kIHBhaXJpbmdcclxuICBjb25zdCBpbmNsdWRlc1ByZXZpb3VzU2F0dXJkYXkgPSBzdGFydERhdGVPYmouZ2V0RGF5KCkgPT09IDA7IC8vIFN1bmRheSA9IDBcclxuICBjb25zdCBhbGxEYXRlczogRGF0ZVtdID0gW107XHJcbiAgXHJcbiAgLy8gQWRkIHByZXZpb3VzIFNhdHVyZGF5IGlmIHN0YXJ0aW5nIG9uIFN1bmRheVxyXG4gIGlmIChpbmNsdWRlc1ByZXZpb3VzU2F0dXJkYXkpIHtcclxuICAgIGNvbnN0IHByZXZpb3VzU2F0dXJkYXkgPSBuZXcgRGF0ZShzdGFydERhdGVPYmopO1xyXG4gICAgcHJldmlvdXNTYXR1cmRheS5zZXREYXRlKHN0YXJ0RGF0ZU9iai5nZXREYXRlKCkgLSAxKTtcclxuICAgIGFsbERhdGVzLnB1c2gocHJldmlvdXNTYXR1cmRheSk7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIEFkZCBhbGwgdGhlIHJlZ3VsYXIgc2NoZWR1bGUgZGF0ZXNcclxuICBmb3IgKGxldCB3ZWVrID0gMDsgd2VlayA8IHdlZWtzOyB3ZWVrKyspIHtcclxuICAgIGZvciAobGV0IGRheSA9IDA7IGRheSA8IDc7IGRheSsrKSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoc3RhcnREYXRlT2JqKTtcclxuICAgICAgY3VycmVudERhdGUuc2V0RGF0ZShzdGFydERhdGVPYmouZ2V0RGF0ZSgpICsgKHdlZWsgKiA3KSArIGRheSk7XHJcbiAgICAgIGFsbERhdGVzLnB1c2goY3VycmVudERhdGUpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvLyBUcmFjayBPbkNhbGwgYW5kIEVhcmx5IGVuZ2luZWVycyBieSB3ZWVrIGZvciBleGNsdXNpb24gbG9naWNcclxuICBjb25zdCBvbkNhbGxCeVdlZWs6IHsgW3dlZWs6IG51bWJlcl06IHN0cmluZyB9ID0ge307XHJcbiAgY29uc3QgZWFybHlCeVdlZWs6IHsgW3dlZWs6IG51bWJlcl06IHN0cmluZyB9ID0ge307XHJcbiAgXHJcbiAgLy8gUHJvY2VzcyBhbGwgZGF0ZXNcclxuICBmb3IgKGxldCBkYXRlSW5kZXggPSAwOyBkYXRlSW5kZXggPCBhbGxEYXRlcy5sZW5ndGg7IGRhdGVJbmRleCsrKSB7XHJcbiAgICBjb25zdCBjdXJyZW50RGF0ZSA9IGFsbERhdGVzW2RhdGVJbmRleF07XHJcbiAgICBjb25zdCBkYXRlU3RyID0gY3VycmVudERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xyXG4gICAgY29uc3QgZGF5ID0gY3VycmVudERhdGUuZ2V0RGF5KCk7IC8vIDA9U3VuZGF5LCAxPU1vbmRheSwgLi4uLCA2PVNhdHVyZGF5XHJcbiAgICBcclxuICAgIGNvbnN0IGRheU5hbWVzID0gWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddO1xyXG4gICAgY29uc3QgZGF5TmFtZSA9IGRheU5hbWVzW2RheV07XHJcbiAgICBjb25zdCBpc1dlZWtkYXkgPSBkYXkgPj0gMSAmJiBkYXkgPD0gNTtcclxuICAgIFxyXG4gICAgLy8gQ2FsY3VsYXRlIGN1cnJlbnQgd2VlayBmb3IgT25DYWxsIHRyYWNraW5nXHJcbiAgICBjb25zdCBkYXlzU2luY2VTdGFydCA9IE1hdGguZmxvb3IoKGN1cnJlbnREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZU9iai5nZXRUaW1lKCkpIC8gKDI0ICogNjAgKiA2MCAqIDEwMDApKTtcclxuICAgIGNvbnN0IGN1cnJlbnRXZWVrID0gTWF0aC5mbG9vcihkYXlzU2luY2VTdGFydCAvIDcpO1xyXG4gICAgICBcclxuICAgICAgLy8gRGV0ZXJtaW5lIHdobyBzaG91bGQgYmUgd29ya2luZ1xyXG4gICAgICBsZXQgZXhwZWN0ZWRXb3JraW5nOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFpc1dlZWtkYXkpIHtcclxuICAgICAgICAvLyBXZWVrZW5kIHJvdGF0aW9uOiBzYW1lIGVuZ2luZWVyIGNvdmVycyBib3RoIFNhdHVyZGF5IGFuZCBTdW5kYXlcclxuICAgICAgICAvLyBDYWxjdWxhdGUgd2hpY2ggd2Vla2VuZCBwYWlyIHRoaXMgYmVsb25ncyB0b1xyXG4gICAgICAgIGxldCB3ZWVrZW5kV2VlazogbnVtYmVyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChkYXkgPT09IDYpIHsgLy8gU2F0dXJkYXlcclxuICAgICAgICAgIC8vIFNhdHVyZGF5IHBhaXJzIHdpdGggdGhlIG5leHQgZGF5IChTdW5kYXkpXHJcbiAgICAgICAgICBjb25zdCBuZXh0RGF5ID0gbmV3IERhdGUoY3VycmVudERhdGUpO1xyXG4gICAgICAgICAgbmV4dERheS5zZXREYXRlKGN1cnJlbnREYXRlLmdldERhdGUoKSArIDEpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoaW5jbHVkZXNQcmV2aW91c1NhdHVyZGF5ICYmIGRhdGVJbmRleCA9PT0gMCkge1xyXG4gICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBTYXR1cmRheSBiZWZvcmUgdGhlIHN0YXJ0IFN1bmRheSAtIGJlbG9uZ3MgdG8gd2VlayAwXHJcbiAgICAgICAgICAgIHdlZWtlbmRXZWVrID0gMDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBiYXNlZCBvbiB0aGUgU3VuZGF5IHRoYXQgZm9sbG93cyB0aGlzIFNhdHVyZGF5XHJcbiAgICAgICAgICAgIGNvbnN0IGRheXNTaW5jZVN1bmRheVN0YXJ0ID0gTWF0aC5mbG9vcigobmV4dERheS5nZXRUaW1lKCkgLSBzdGFydERhdGVPYmouZ2V0VGltZSgpKSAvICgyNCAqIDYwICogNjAgKiAxMDAwKSk7XHJcbiAgICAgICAgICAgIHdlZWtlbmRXZWVrID0gTWF0aC5mbG9vcihkYXlzU2luY2VTdW5kYXlTdGFydCAvIDcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7IC8vIFN1bmRheSAoZGF5ID09PSAwKVxyXG4gICAgICAgICAgLy8gQ2FsY3VsYXRlIGJhc2VkIG9uIHRoaXMgU3VuZGF5XHJcbiAgICAgICAgICBjb25zdCBkYXlzU2luY2VTdW5kYXlTdGFydCA9IE1hdGguZmxvb3IoKGN1cnJlbnREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZU9iai5nZXRUaW1lKCkpIC8gKDI0ICogNjAgKiA2MCAqIDEwMDApKTtcclxuICAgICAgICAgIHdlZWtlbmRXZWVrID0gTWF0aC5mbG9vcihkYXlzU2luY2VTdW5kYXlTdGFydCAvIDcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBpZiB3ZSBhbHJlYWR5IGFzc2lnbmVkIHRoaXMgd2Vla2VuZCAoZm9yIFNhdHVyZGF5L1N1bmRheSBwYWlyaW5nKVxyXG4gICAgICAgIGxldCBpbnRlbmRlZEVuZ2luZWVyOiBzdHJpbmc7XHJcbiAgICAgICAgaWYgKHdlZWtlbmRBc3NpZ25tZW50Q2FjaGVbd2Vla2VuZFdlZWtdKSB7XHJcbiAgICAgICAgICAvLyBVc2UgY2FjaGVkIGFzc2lnbm1lbnQgdG8gZW5zdXJlIFNhdHVyZGF5L1N1bmRheSBwYWlyaW5nXHJcbiAgICAgICAgICBpbnRlbmRlZEVuZ2luZWVyID0gd2Vla2VuZEFzc2lnbm1lbnRDYWNoZVt3ZWVrZW5kV2Vla107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIEZpcnN0IHRpbWUgYXNzaWduaW5nIHRoaXMgd2Vla2VuZCAtIGNhbGN1bGF0ZSB3aXRoIGNvbmZsaWN0IHByZXZlbnRpb25cclxuICAgICAgICAgIGxldCBpbnRlbmRlZEVuZ2luZWVySWR4ID0gKHdlZWtlbmRXZWVrICsgc2VlZHMud2Vla2VuZCkgJSBlbmdpbmVlcnMubGVuZ3RoO1xyXG4gICAgICAgICAgaW50ZW5kZWRFbmdpbmVlciA9IGVuZ2luZWVyc1tpbnRlbmRlZEVuZ2luZWVySWR4XTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gQ2hlY2sgZm9yIGNvbnNlY3V0aXZlIHdlZWtlbmQgcHJldmVudGlvblxyXG4gICAgICAgICAgbGV0IHByZXZpb3VzV2Vla2VuZEVuZ2luZWVyOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICAgICAgICAgIGlmICh3ZWVrZW5kV2VlayA+IDAgJiYgd2Vla2VuZEFzc2lnbm1lbnRDYWNoZVt3ZWVrZW5kV2VlayAtIDFdKSB7XHJcbiAgICAgICAgICAgIHByZXZpb3VzV2Vla2VuZEVuZ2luZWVyID0gd2Vla2VuZEFzc2lnbm1lbnRDYWNoZVt3ZWVrZW5kV2VlayAtIDFdO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBDaGVjayBpZiBpbnRlbmRlZCBlbmdpbmVlciB3YXMgT25DYWxsIGluIHByZXZpb3VzIHdlZWtcclxuICAgICAgICAgIGNvbnN0IHByZXZpb3VzV2VlayA9IHdlZWtlbmRXZWVrIC0gMTtcclxuICAgICAgICAgIGNvbnN0IHByZXZpb3VzT25DYWxsID0gb25DYWxsQnlXZWVrW3ByZXZpb3VzV2Vla107XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIEFwcGx5IGV4Y2x1c2lvbnM6IGNvbnNlY3V0aXZlIHdlZWtlbmQgcHJldmVudGlvbiBhbmQgT25DYWxsIGNvbmZsaWN0IHByZXZlbnRpb25cclxuICAgICAgICAgIGNvbnN0IGV4Y2x1c2lvbnM6IHN0cmluZ1tdID0gW107XHJcbiAgICAgICAgICBsZXQgZXhjbHVzaW9uUmVhc29uczogc3RyaW5nW10gPSBbXTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKHByZXZpb3VzV2Vla2VuZEVuZ2luZWVyICYmIHByZXZpb3VzV2Vla2VuZEVuZ2luZWVyID09PSBpbnRlbmRlZEVuZ2luZWVyKSB7XHJcbiAgICAgICAgICAgIGV4Y2x1c2lvbnMucHVzaChwcmV2aW91c1dlZWtlbmRFbmdpbmVlcik7XHJcbiAgICAgICAgICAgIGV4Y2x1c2lvblJlYXNvbnMucHVzaChgZGlkIHByZXZpb3VzIHdlZWtlbmQgKHdlZWsgJHt3ZWVrZW5kV2VlayAtIDF9KWApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAocHJldmlvdXNPbkNhbGwgJiYgcHJldmlvdXNPbkNhbGwgPT09IGludGVuZGVkRW5naW5lZXIgJiYgIWV4Y2x1c2lvbnMuaW5jbHVkZXMocHJldmlvdXNPbkNhbGwpKSB7XHJcbiAgICAgICAgICAgIGV4Y2x1c2lvbnMucHVzaChwcmV2aW91c09uQ2FsbCk7XHJcbiAgICAgICAgICAgIGV4Y2x1c2lvblJlYXNvbnMucHVzaChgd2FzIE9uQ2FsbCBpbiBwcmV2aW91cyB3ZWVrYCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGlmIChleGNsdXNpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8gRmluZCBuZXh0IGF2YWlsYWJsZSBlbmdpbmVlciB3aG8gZG9lc24ndCBoYXZlIGNvbmZsaWN0c1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGVuZ2luZWVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgIGNvbnN0IG5leHRJZHggPSAoaW50ZW5kZWRFbmdpbmVlcklkeCArIGkpICUgZW5naW5lZXJzLmxlbmd0aDtcclxuICAgICAgICAgICAgICBjb25zdCBuZXh0RW5naW5lZXIgPSBlbmdpbmVlcnNbbmV4dElkeF07XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBlbmdpbmVlciBoYXMgYW55IGNvbmZsaWN0c1xyXG4gICAgICAgICAgICAgIGNvbnN0IGhhc0NvbnNlY3V0aXZlV2Vla2VuZENvbmZsaWN0ID0gcHJldmlvdXNXZWVrZW5kRW5naW5lZXIgJiYgbmV4dEVuZ2luZWVyID09PSBwcmV2aW91c1dlZWtlbmRFbmdpbmVlcjtcclxuICAgICAgICAgICAgICBjb25zdCBoYXNPbkNhbGxDb25mbGljdCA9IHByZXZpb3VzT25DYWxsICYmIG5leHRFbmdpbmVlciA9PT0gcHJldmlvdXNPbkNhbGw7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgaWYgKCFoYXNDb25zZWN1dGl2ZVdlZWtlbmRDb25mbGljdCAmJiAhaGFzT25DYWxsQ29uZmxpY3QpIHtcclxuICAgICAgICAgICAgICAgIGludGVuZGVkRW5naW5lZXIgPSBuZXh0RW5naW5lZXI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIExvZyB0aGUgZXhjbHVzaW9uIGFuZCBmYWxsYmFja1xyXG4gICAgICAgICAgICBkZWNpc2lvbkxvZy5wdXNoKHtcclxuICAgICAgICAgICAgICBkYXRlOiBkYXRlU3RyLFxyXG4gICAgICAgICAgICAgIGRlY2lzaW9uX3R5cGU6ICd3ZWVrZW5kX2NvbmZsaWN0X3ByZXZlbnRpb24nLFxyXG4gICAgICAgICAgICAgIGFmZmVjdGVkX2VuZ2luZWVyczogZXhjbHVzaW9ucyxcclxuICAgICAgICAgICAgICByZWFzb246IGAke2V4Y2x1c2lvbnMuam9pbignLCAnKX0gZXhjbHVkZWQgZnJvbSB3ZWVrZW5kICgke2V4Y2x1c2lvblJlYXNvbnMuam9pbignLCAnKX0pLCBhc3NpZ25lZCAke2ludGVuZGVkRW5naW5lZXJ9IGluc3RlYWRgLFxyXG4gICAgICAgICAgICAgIGFsdGVybmF0aXZlc19jb25zaWRlcmVkOiBbZW5naW5lZXJzW2ludGVuZGVkRW5naW5lZXJJZHhdXSxcclxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gQ2FjaGUgdGhlIGFzc2lnbm1lbnQgZm9yIFNhdHVyZGF5L1N1bmRheSBwYWlyaW5nXHJcbiAgICAgICAgICB3ZWVrZW5kQXNzaWdubWVudENhY2hlW3dlZWtlbmRXZWVrXSA9IGludGVuZGVkRW5naW5lZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cGVjdGVkV29ya2luZyA9IFtpbnRlbmRlZEVuZ2luZWVyXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBBbGwgZW5naW5lZXJzIGF2YWlsYWJsZSBmb3Igd2Vla2RheXMgaW5pdGlhbGx5XHJcbiAgICAgICAgZXhwZWN0ZWRXb3JraW5nID0gWy4uLmVuZ2luZWVyc107XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEZpbmQgd2hvJ3Mgb24gbGVhdmUgdG9kYXlcclxuICAgICAgY29uc3Qgb25MZWF2ZVRvZGF5ID0gZW5naW5lZXJzLmZpbHRlcihlbmcgPT4gbGVhdmVNYXBbZW5nXS5oYXMoZGF0ZVN0cikpO1xyXG4gICAgICBcclxuICAgICAgaWYgKG9uTGVhdmVUb2RheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZGVjaXNpb25Mb2cucHVzaCh7XHJcbiAgICAgICAgICBkYXRlOiBkYXRlU3RyLFxyXG4gICAgICAgICAgZGVjaXNpb25fdHlwZTogJ2xlYXZlX2V4Y2x1c2lvbicsXHJcbiAgICAgICAgICBhZmZlY3RlZF9lbmdpbmVlcnM6IG9uTGVhdmVUb2RheSxcclxuICAgICAgICAgIHJlYXNvbjogYEVuZ2luZWVycyBleGNsdWRlZCBkdWUgdG8gc2NoZWR1bGVkIGxlYXZlIG9uICR7ZGF5TmFtZX1gLFxyXG4gICAgICAgICAgYWx0ZXJuYXRpdmVzX2NvbnNpZGVyZWQ6IFsnRW5oYW5jZWQgYmFja2ZpbGwgc2VsZWN0aW9uIHdpbGwgZmluZCBhbHRlcm5hdGl2ZXMnXSxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEF2YWlsYWJsZSBlbmdpbmVlcnMgKG5vdCBvbiBsZWF2ZSlcclxuICAgICAgY29uc3QgYXZhaWxhYmxlID0gZW5naW5lZXJzLmZpbHRlcihlbmcgPT4gIW9uTGVhdmVUb2RheS5pbmNsdWRlcyhlbmcpKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEVuaGFuY2VkIGJhY2tmaWxsIGxvZ2ljIGZvciBpbnN1ZmZpY2llbnQgY292ZXJhZ2VcclxuICAgICAgY29uc3QgaW5pdGlhbFdvcmtpbmcgPSBleHBlY3RlZFdvcmtpbmcuZmlsdGVyKGVuZyA9PiAhb25MZWF2ZVRvZGF5LmluY2x1ZGVzKGVuZykpO1xyXG4gICAgICBsZXQgd29ya2luZyA9IFsuLi5pbml0aWFsV29ya2luZ107IC8vIEV4cGxpY2l0bHkgbXV0YWJsZSBhcnJheVxyXG4gICAgICBjb25zdCBtaW5SZXF1aXJlZCA9IGlzV2Vla2RheSA/IDMgOiAxO1xyXG4gICAgICBcclxuICAgICAgaWYgKHdvcmtpbmcubGVuZ3RoIDwgbWluUmVxdWlyZWQgJiYgYXZhaWxhYmxlLmxlbmd0aCA+IHdvcmtpbmcubGVuZ3RoKSB7XHJcbiAgICAgICAgLy8gRmluZCBiYWNrZmlsbCBjYW5kaWRhdGVzIChhdmFpbGFibGUgYnV0IG5vdCBleHBlY3RlZCB0byB3b3JrKVxyXG4gICAgICAgIGNvbnN0IGJhY2tmaWxsQ2FuZGlkYXRlcyA9IGF2YWlsYWJsZS5maWx0ZXIoZW5nID0+ICFleHBlY3RlZFdvcmtpbmcuaW5jbHVkZXMoZW5nKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGJhY2tmaWxsQ2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAvLyBFbmhhbmNlZCBiYWNrZmlsbCBzZWxlY3Rpb24gd2l0aCBmYWlybmVzcyBjb25zaWRlcmF0aW9uXHJcbiAgICAgICAgICAvLyBTaW1wbGUgZmFpcm5lc3M6IHByZWZlciBlbmdpbmVlcnMgd2l0aCBmZXdlciByZWNlbnQgYXNzaWdubWVudHNcclxuICAgICAgICAgIGNvbnN0IG5lZWRlZCA9IE1hdGgubWluKG1pblJlcXVpcmVkIC0gd29ya2luZy5sZW5ndGgsIGJhY2tmaWxsQ2FuZGlkYXRlcy5sZW5ndGgpO1xyXG4gICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBiYWNrZmlsbENhbmRpZGF0ZXMuc2xpY2UoMCwgbmVlZGVkKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgd29ya2luZyA9IFsuLi53b3JraW5nLCAuLi5zZWxlY3RlZF07IC8vIEV4cGxpY2l0IHJlYXNzaWdubWVudFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBkZWNpc2lvbkxvZy5wdXNoKHtcclxuICAgICAgICAgICAgZGF0ZTogZGF0ZVN0cixcclxuICAgICAgICAgICAgZGVjaXNpb25fdHlwZTogJ2VuaGFuY2VkX2JhY2tmaWxsX3NlbGVjdGlvbicsXHJcbiAgICAgICAgICAgIGFmZmVjdGVkX2VuZ2luZWVyczogc2VsZWN0ZWQsXHJcbiAgICAgICAgICAgIHJlYXNvbjogYEZvdW5kICR7YmFja2ZpbGxDYW5kaWRhdGVzLmxlbmd0aH0gY2FuZGlkYXRlcywgc2VsZWN0ZWQgJHtzZWxlY3RlZC5sZW5ndGh9IGJhc2VkIG9uIGZhaXJuZXNzIHdlaWdodGluZyBmb3IgJHttaW5SZXF1aXJlZH0gcmVxdWlyZWQgcm9sZXNgLFxyXG4gICAgICAgICAgICBhbHRlcm5hdGl2ZXNfY29uc2lkZXJlZDogYmFja2ZpbGxDYW5kaWRhdGVzLnNsaWNlKG5lZWRlZCwgbmVlZGVkICsgMiksXHJcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIFJvbGUgYXNzaWdubWVudHNcclxuICAgICAgY29uc3QgZGF5U2NoZWR1bGU6IGFueSA9IHtcclxuICAgICAgICBEYXRlOiBkYXRlU3RyLFxyXG4gICAgICAgIERheTogZGF5TmFtZSxcclxuICAgICAgICBXZWVrZW5kOiAnJyxcclxuICAgICAgICBDaGF0OiAnJyxcclxuICAgICAgICBPbkNhbGw6ICcnLFxyXG4gICAgICAgIEFwcG9pbnRtZW50czogJycsXHJcbiAgICAgICAgRWFybHk6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWlzV2Vla2RheSAmJiB3b3JraW5nLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBXZWVrZW5kIGFzc2lnbm1lbnQgLSBzYW1lIGVuZ2luZWVyIGNvdmVycyBib3RoIFNhdHVyZGF5IGFuZCBTdW5kYXlcclxuICAgICAgICBjb25zdCB3ZWVrZW5kRW5naW5lZXIgPSB3b3JraW5nWzBdO1xyXG4gICAgICAgIGRheVNjaGVkdWxlLldlZWtlbmQgPSB3ZWVrZW5kRW5naW5lZXI7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gV2Vla2VuZCBlbmdpbmVlciBhbHNvIGNvdmVycyBPbkNhbGwgZm9yIHRoZSB3ZWVrZW5kXHJcbiAgICAgICAgZGF5U2NoZWR1bGUuT25DYWxsID0gd2Vla2VuZEVuZ2luZWVyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIExvZyB3ZWVrZW5kIGFzc2lnbm1lbnQgZGVjaXNpb25cclxuICAgICAgICBkZWNpc2lvbkxvZy5wdXNoKHtcclxuICAgICAgICAgIGRhdGU6IGRhdGVTdHIsXHJcbiAgICAgICAgICBkZWNpc2lvbl90eXBlOiAnd2Vla2VuZF9hc3NpZ25tZW50JyxcclxuICAgICAgICAgIGFmZmVjdGVkX2VuZ2luZWVyczogW3dlZWtlbmRFbmdpbmVlcl0sXHJcbiAgICAgICAgICByZWFzb246IGBXZWVrZW5kIGFzc2lnbm1lbnQgZm9yICR7ZGF5TmFtZX0gLSAke3dlZWtlbmRFbmdpbmVlcn0gY292ZXJzIGVudGlyZSB3ZWVrZW5kIChTYXR1cmRheSAmIFN1bmRheSkgYW5kIE9uQ2FsbCBkdXRpZXNgLFxyXG4gICAgICAgICAgYWx0ZXJuYXRpdmVzX2NvbnNpZGVyZWQ6IHdvcmtpbmcuc2xpY2UoMSwgMyksXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2UgaWYgKGlzV2Vla2RheSAmJiB3b3JraW5nLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBXZWVrZGF5IHJvbGUgYXNzaWdubWVudHMgd2l0aCByb3RhdGlvblxyXG4gICAgICAgIGNvbnN0IGRheU9mZnNldCA9IChjdXJyZW50V2VlayAqIDcpICsgZGF5O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEFzc2lnbiBPbkNhbGwgZW5naW5lZXIgZm9yIHRoZSB3ZWVrIChpZiBub3QgYWxyZWFkeSBhc3NpZ25lZClcclxuICAgICAgICBsZXQgb25DYWxsRW5naW5lZXI6IHN0cmluZztcclxuICAgICAgICBpZiAob25DYWxsQnlXZWVrW2N1cnJlbnRXZWVrXSkge1xyXG4gICAgICAgICAgb25DYWxsRW5naW5lZXIgPSBvbkNhbGxCeVdlZWtbY3VycmVudFdlZWtdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBGaW5kIGludGVuZGVkIE9uQ2FsbCBlbmdpbmVlclxyXG4gICAgICAgICAgbGV0IGludGVuZGVkT25DYWxsSWR4ID0gKGN1cnJlbnRXZWVrICsgc2VlZHMub25jYWxsKSAlIHdvcmtpbmcubGVuZ3RoO1xyXG4gICAgICAgICAgbGV0IGludGVuZGVkT25DYWxsID0gd29ya2luZ1tpbnRlbmRlZE9uQ2FsbElkeF07XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIENoZWNrIGlmIGludGVuZGVkIGVuZ2luZWVyIGRpZCB0aGUgcHJldmlvdXMgd2Vla2VuZCAod29yay1saWZlIGJhbGFuY2UpXHJcbiAgICAgICAgICAvLyBQcmV2aW91cyB3ZWVrZW5kIHdvdWxkIGJlIGF0IHRoZSBlbmQgb2YgdGhlIHByZXZpb3VzIHdlZWtcclxuICAgICAgICAgIGNvbnN0IHByZXZpb3VzV2Vla2VuZCA9IGN1cnJlbnRXZWVrIC0gMTtcclxuICAgICAgICAgIGxldCBwcmV2aW91c1dlZWtlbmRFbmdpbmVlcjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIExvb2sgdGhyb3VnaCB3ZWVrZW5kIGVudHJpZXMgdG8gZmluZCB3aG8gZGlkIHRoZSBwcmV2aW91cyB3ZWVrZW5kXHJcbiAgICAgICAgICBjb25zdCBwcmV2aW91c1dlZWtlbmRTdW5kYXkgPSBuZXcgRGF0ZShzdGFydERhdGVPYmopO1xyXG4gICAgICAgICAgcHJldmlvdXNXZWVrZW5kU3VuZGF5LnNldERhdGUoc3RhcnREYXRlT2JqLmdldERhdGUoKSArIChwcmV2aW91c1dlZWtlbmQgKiA3KSk7XHJcbiAgICAgICAgICBjb25zdCBwcmV2aW91c1dlZWtlbmRTdW5kYXlTdHIgPSBwcmV2aW91c1dlZWtlbmRTdW5kYXkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBGaW5kIHdobyBkaWQgdGhlIHByZXZpb3VzIHdlZWtlbmQgYnkgY2hlY2tpbmcgcHJvY2Vzc2VkIHNjaGVkdWxlXHJcbiAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHNjaGVkdWxlKSB7XHJcbiAgICAgICAgICAgIGlmIChlbnRyeS5EYXRlID09PSBwcmV2aW91c1dlZWtlbmRTdW5kYXlTdHIgJiYgZW50cnkuV2Vla2VuZCkge1xyXG4gICAgICAgICAgICAgIHByZXZpb3VzV2Vla2VuZEVuZ2luZWVyID0gZW50cnkuV2Vla2VuZDtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBBbHNvIGNoZWNrIGlmIGludGVuZGVkIGVuZ2luZWVyIHdpbGwgZG8gdGhlIGN1cnJlbnQgd2VlaydzIHdlZWtlbmRcclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRXZWVrZW5kU3VuZGF5ID0gbmV3IERhdGUoc3RhcnREYXRlT2JqKTtcclxuICAgICAgICAgIGN1cnJlbnRXZWVrZW5kU3VuZGF5LnNldERhdGUoc3RhcnREYXRlT2JqLmdldERhdGUoKSArIChjdXJyZW50V2VlayAqIDcpKTtcclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRXZWVrZW5kU3VuZGF5U3RyID0gY3VycmVudFdlZWtlbmRTdW5kYXkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBsZXQgY3VycmVudFdlZWtlbmRFbmdpbmVlcjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHNjaGVkdWxlKSB7XHJcbiAgICAgICAgICAgIGlmIChlbnRyeS5EYXRlID09PSBjdXJyZW50V2Vla2VuZFN1bmRheVN0ciAmJiBlbnRyeS5XZWVrZW5kKSB7XHJcbiAgICAgICAgICAgICAgY3VycmVudFdlZWtlbmRFbmdpbmVlciA9IGVudHJ5LldlZWtlbmQ7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gSWYgaW50ZW5kZWQgT25DYWxsIGVuZ2luZWVyIGRpZCBwcmV2aW91cyB3ZWVrZW5kIE9SIHdpbGwgZG8gY3VycmVudCB3ZWVrZW5kLCBmaW5kIGFsdGVybmF0aXZlXHJcbiAgICAgICAgICBjb25zdCBoYXNXZWVrZW5kQ29uZmxpY3QgPSAocHJldmlvdXNXZWVrZW5kRW5naW5lZXIgJiYgaW50ZW5kZWRPbkNhbGwgPT09IHByZXZpb3VzV2Vla2VuZEVuZ2luZWVyKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjdXJyZW50V2Vla2VuZEVuZ2luZWVyICYmIGludGVuZGVkT25DYWxsID09PSBjdXJyZW50V2Vla2VuZEVuZ2luZWVyKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKGhhc1dlZWtlbmRDb25mbGljdCkge1xyXG4gICAgICAgICAgICAvLyBGaW5kIG5leHQgYXZhaWxhYmxlIGVuZ2luZWVyIHdobyBkb2Vzbid0IGhhdmUgd2Vla2VuZCBjb25mbGljdHNcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB3b3JraW5nLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgbmV4dElkeCA9IChpbnRlbmRlZE9uQ2FsbElkeCArIGkpICUgd29ya2luZy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgY29uc3QgbmV4dEVuZ2luZWVyID0gd29ya2luZ1tuZXh0SWR4XTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGVuZ2luZWVyIGhhcyB3ZWVrZW5kIGNvbmZsaWN0c1xyXG4gICAgICAgICAgICAgIGNvbnN0IGhhc1ByZXZpb3VzV2Vla2VuZENvbmZsaWN0ID0gcHJldmlvdXNXZWVrZW5kRW5naW5lZXIgJiYgbmV4dEVuZ2luZWVyID09PSBwcmV2aW91c1dlZWtlbmRFbmdpbmVlcjtcclxuICAgICAgICAgICAgICBjb25zdCBoYXNDdXJyZW50V2Vla2VuZENvbmZsaWN0ID0gY3VycmVudFdlZWtlbmRFbmdpbmVlciAmJiBuZXh0RW5naW5lZXIgPT09IGN1cnJlbnRXZWVrZW5kRW5naW5lZXI7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgaWYgKCFoYXNQcmV2aW91c1dlZWtlbmRDb25mbGljdCAmJiAhaGFzQ3VycmVudFdlZWtlbmRDb25mbGljdCkge1xyXG4gICAgICAgICAgICAgICAgaW50ZW5kZWRPbkNhbGwgPSBuZXh0RW5naW5lZXI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIExvZyB0aGUgZXhjbHVzaW9uIGFuZCBmYWxsYmFja1xyXG4gICAgICAgICAgICBjb25zdCBjb25mbGljdEVuZ2luZWVyID0gcHJldmlvdXNXZWVrZW5kRW5naW5lZXIgfHwgY3VycmVudFdlZWtlbmRFbmdpbmVlcjtcclxuICAgICAgICAgICAgY29uc3QgY29uZmxpY3RSZWFzb24gPSBwcmV2aW91c1dlZWtlbmRFbmdpbmVlciA/ICdkaWQgcHJldmlvdXMgd2Vla2VuZCcgOiAnd2lsbCBkbyBjdXJyZW50IHdlZWtlbmQnO1xyXG4gICAgICAgICAgICBkZWNpc2lvbkxvZy5wdXNoKHtcclxuICAgICAgICAgICAgICBkYXRlOiBkYXRlU3RyLFxyXG4gICAgICAgICAgICAgIGRlY2lzaW9uX3R5cGU6ICdvbmNhbGxfd2Vla2VuZF9leGNsdXNpb24nLFxyXG4gICAgICAgICAgICAgIGFmZmVjdGVkX2VuZ2luZWVyczogW2NvbmZsaWN0RW5naW5lZXIhXSxcclxuICAgICAgICAgICAgICByZWFzb246IGAke2NvbmZsaWN0RW5naW5lZXJ9IGV4Y2x1ZGVkIGZyb20gT25DYWxsICgke2NvbmZsaWN0UmVhc29ufSksIGFzc2lnbmVkICR7aW50ZW5kZWRPbkNhbGx9IGluc3RlYWRgLFxyXG4gICAgICAgICAgICAgIGFsdGVybmF0aXZlc19jb25zaWRlcmVkOiBbd29ya2luZ1tpbnRlbmRlZE9uQ2FsbElkeF1dLFxyXG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBvbkNhbGxFbmdpbmVlciA9IGludGVuZGVkT25DYWxsO1xyXG4gICAgICAgICAgb25DYWxsQnlXZWVrW2N1cnJlbnRXZWVrXSA9IG9uQ2FsbEVuZ2luZWVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkYXlTY2hlZHVsZS5PbkNhbGwgPSBvbkNhbGxFbmdpbmVlcjtcclxuICAgICAgICBcclxuICAgICAgICAvLyBBc3NpZ24gRWFybHkgZW5naW5lZXIgZm9yIHRoZSB3ZWVrIChpZiBub3QgYWxyZWFkeSBhc3NpZ25lZClcclxuICAgICAgICBsZXQgZWFybHlFbmdpbmVlcjogc3RyaW5nO1xyXG4gICAgICAgIGlmIChlYXJseUJ5V2Vla1tjdXJyZW50V2Vla10pIHtcclxuICAgICAgICAgIGVhcmx5RW5naW5lZXIgPSBlYXJseUJ5V2Vla1tjdXJyZW50V2Vla107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGVhcmx5RW5naW5lZXIgPSB3b3JraW5nWyhjdXJyZW50V2VlayArIHNlZWRzLmVhcmx5KSAlIHdvcmtpbmcubGVuZ3RoXTtcclxuICAgICAgICAgIGVhcmx5QnlXZWVrW2N1cnJlbnRXZWVrXSA9IGVhcmx5RW5naW5lZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRheVNjaGVkdWxlLkVhcmx5ID0gZWFybHlFbmdpbmVlcjtcclxuICAgICAgICBcclxuICAgICAgICAvLyBGaWx0ZXIgb3V0IE9OTFkgT25DYWxsIGVuZ2luZWVyIGZyb20gQ2hhdC9BcHBvaW50bWVudHMgKEVhcmx5IGVuZ2luZWVyIGNhbiBkbyBib3RoKVxyXG4gICAgICAgIGNvbnN0IG5vbk9uQ2FsbEVuZ2luZWVycyA9IHdvcmtpbmcuZmlsdGVyKGVuZyA9PiBlbmcgIT09IG9uQ2FsbEVuZ2luZWVyKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAobm9uT25DYWxsRW5naW5lZXJzLmxlbmd0aCA+PSAxKSB7XHJcbiAgICAgICAgICBkYXlTY2hlZHVsZS5DaGF0ID0gbm9uT25DYWxsRW5naW5lZXJzWyhkYXlPZmZzZXQgKyBzZWVkcy5jaGF0KSAlIG5vbk9uQ2FsbEVuZ2luZWVycy5sZW5ndGhdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobm9uT25DYWxsRW5naW5lZXJzLmxlbmd0aCA+PSAyKSB7XHJcbiAgICAgICAgICBkYXlTY2hlZHVsZS5BcHBvaW50bWVudHMgPSBub25PbkNhbGxFbmdpbmVlcnNbKGRheU9mZnNldCArIHNlZWRzLmFwcG9pbnRtZW50cykgJSBub25PbkNhbGxFbmdpbmVlcnMubGVuZ3RoXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gTG9nIGVuaGFuY2VkIHJvbGUgYXNzaWdubWVudHNcclxuICAgICAgICBjb25zdCBhc3NpZ25lZFJvbGVzID0gT2JqZWN0LmVudHJpZXMoZGF5U2NoZWR1bGUpXHJcbiAgICAgICAgICAuZmlsdGVyKChba2V5LCB2YWx1ZV0pID0+IGtleSAhPT0gJ0RhdGUnICYmIGtleSAhPT0gJ0RheScgJiYgdmFsdWUpXHJcbiAgICAgICAgICAubWFwKChbcm9sZSwgZW5naW5lZXJdKSA9PiBgJHtyb2xlfTogJHtlbmdpbmVlcn1gKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoYXNzaWduZWRSb2xlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBkZWNpc2lvbkxvZy5wdXNoKHtcclxuICAgICAgICAgICAgZGF0ZTogZGF0ZVN0cixcclxuICAgICAgICAgICAgZGVjaXNpb25fdHlwZTogJ2VuaGFuY2VkX3JvbGVfYXNzaWdubWVudCcsXHJcbiAgICAgICAgICAgIGFmZmVjdGVkX2VuZ2luZWVyczogT2JqZWN0LnZhbHVlcyhkYXlTY2hlZHVsZSkuZmlsdGVyKHYgPT4gdiAmJiB2ICE9PSBkYXRlU3RyICYmIHYgIT09IGRheU5hbWUpIGFzIHN0cmluZ1tdLFxyXG4gICAgICAgICAgICByZWFzb246IGBFbmhhbmNlZCByb2xlIGFzc2lnbm1lbnQgZm9yICR7ZGF5TmFtZX0gd2l0aCAke3dvcmtpbmcubGVuZ3RofSBhdmFpbGFibGUgZW5naW5lZXJzYCxcclxuICAgICAgICAgICAgYWx0ZXJuYXRpdmVzX2NvbnNpZGVyZWQ6IHdvcmtpbmcuc2xpY2UoYXNzaWduZWRSb2xlcy5sZW5ndGgpLFxyXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBzY2hlZHVsZS5wdXNoKGRheVNjaGVkdWxlKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gR2VuZXJhdGUgZmFpcm5lc3MgcmVwb3J0XHJcbiAgY29uc3QgZW5naW5lZXJTdGF0cyA9IGVuZ2luZWVycy5tYXAoZW5nID0+IHtcclxuICAgIGNvbnN0IGFzc2lnbm1lbnRzID0gc2NoZWR1bGUuZmlsdGVyKGRheSA9PiBcclxuICAgICAgT2JqZWN0LnZhbHVlcyhkYXkpLmluY2x1ZGVzKGVuZylcclxuICAgICkubGVuZ3RoO1xyXG4gICAgcmV0dXJuIHsgZW5naW5lZXI6IGVuZywgdG90YWxBc3NpZ25tZW50czogYXNzaWdubWVudHMgfTtcclxuICB9KTtcclxuICBcclxuICByZXR1cm4ge1xyXG4gICAgc2NoZWR1bGUsXHJcbiAgICBtZXRhZGF0YToge1xyXG4gICAgICBlbmdpbmVlcnMsXHJcbiAgICAgIHN0YXJ0RGF0ZSxcclxuICAgICAgd2Vla3MsXHJcbiAgICAgIGxlYXZlRW50cmllczogbGVhdmUubGVuZ3RoLFxyXG4gICAgICBnZW5lcmF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9LFxyXG4gICAgZmFpcm5lc3NSZXBvcnQ6IHtcclxuICAgICAgdG90YWxBc3NpZ25tZW50czogc2NoZWR1bGUubGVuZ3RoICogcm9sZXMubGVuZ3RoLFxyXG4gICAgICBlbmdpbmVlclN0YXRzLFxyXG4gICAgICBsZWF2ZUltcGFjdDogbGVhdmUubGVuZ3RoID4gMCA/ICdFbmhhbmNlZCBiYWNrZmlsbCBpbnRlZ3JhdGlvbiBhY3RpdmUnIDogJ05vIGxlYXZlIGVudHJpZXMnXHJcbiAgICB9LFxyXG4gICAgZGVjaXNpb25Mb2dcclxuICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZUNTVihkYXRhOiBFbmhhbmNlZFNjaGVkdWxlUmVzdWx0KSB7XHJcbiAgY29uc3QgeyBzY2hlZHVsZSB9ID0gZGF0YTtcclxuICBcclxuICBpZiAoc2NoZWR1bGUubGVuZ3RoID09PSAwKSByZXR1cm4gJ05vIHNjaGVkdWxlIGRhdGEgYXZhaWxhYmxlJztcclxuICBcclxuICAvLyBHZXQgaGVhZGVycyBmcm9tIGZpcnN0IHJvd1xyXG4gIGNvbnN0IGhlYWRlcnMgPSBPYmplY3Qua2V5cyhzY2hlZHVsZVswXSk7XHJcbiAgbGV0IGNzdiA9IGhlYWRlcnMuam9pbignLCcpICsgJ1xcbic7XHJcbiAgXHJcbiAgc2NoZWR1bGUuZm9yRWFjaCgocm93OiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHZhbHVlcyA9IGhlYWRlcnMubWFwKGhlYWRlciA9PiByb3dbaGVhZGVyXSB8fCAnJyk7XHJcbiAgICBjc3YgKz0gdmFsdWVzLmpvaW4oJywnKSArICdcXG4nO1xyXG4gIH0pO1xyXG4gIFxyXG4gIHJldHVybiBjc3Y7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBlbmdpbmVlcnMsIHN0YXJ0X3N1bmRheSwgd2Vla3MsIHNlZWRzLCBsZWF2ZSA9IFtdLCBmb3JtYXQgPSAnY3N2JyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgLy8gQmFzaWMgdmFsaWRhdGlvblxyXG4gICAgaWYgKCFlbmdpbmVlcnMgfHwgIUFycmF5LmlzQXJyYXkoZW5naW5lZXJzKSB8fCBlbmdpbmVlcnMubGVuZ3RoICE9PSA2KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxyXG4gICAgICAgIGVycm9yOiAnRXhhY3RseSA2IGVuZ2luZWVycyByZXF1aXJlZCcsXHJcbiAgICAgICAgZGV0YWlsczogJ1BsZWFzZSBwcm92aWRlIGV4YWN0bHkgNiB1bmlxdWUgZW5naW5lZXIgbmFtZXMnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghc3RhcnRfc3VuZGF5KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxyXG4gICAgICAgIGVycm9yOiAnU3RhcnQgZGF0ZSByZXF1aXJlZCcsXHJcbiAgICAgICAgZGV0YWlsczogJ1BsZWFzZSBwcm92aWRlIGEgc3RhcnRfc3VuZGF5IGRhdGUgaW4gWVlZWS1NTS1ERCBmb3JtYXQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghd2Vla3MgfHwgd2Vla3MgPCAxIHx8IHdlZWtzID4gNTIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXHJcbiAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHdlZWtzJyxcclxuICAgICAgICBkZXRhaWxzOiAnV2Vla3MgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDUyJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBFbnN1cmUgc2VlZHMgaGF2ZSBkZWZhdWx0IHZhbHVlc1xyXG4gICAgY29uc3QgZGVmYXVsdFNlZWRzID0geyB3ZWVrZW5kOiAwLCBjaGF0OiAwLCBvbmNhbGw6IDEsIGFwcG9pbnRtZW50czogMiwgZWFybHk6IDAgfTtcclxuICAgIGNvbnN0IGZpbmFsU2VlZHMgPSB7IC4uLmRlZmF1bHRTZWVkcywgLi4uKHNlZWRzIHx8IHt9KSB9O1xyXG5cclxuICAgIC8vIEdlbmVyYXRlIGVuaGFuY2VkIHNjaGVkdWxlIHdpdGggYmFja2ZpbGwgaW50ZWdyYXRpb25cclxuICAgIGNvbnN0IHNjaGVkdWxlRGF0YSA9IGdlbmVyYXRlRW5oYW5jZWRTY2hlZHVsZShlbmdpbmVlcnMsIHN0YXJ0X3N1bmRheSwgd2Vla3MsIGZpbmFsU2VlZHMsIGxlYXZlKTtcclxuXHJcbiAgICBpZiAoZm9ybWF0ID09PSAnanNvbicpIHtcclxuICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHNjaGVkdWxlRGF0YSk7XHJcbiAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gJ2NzdicpIHtcclxuICAgICAgY29uc3QgY3N2ID0gZ2VuZXJhdGVDU1Yoc2NoZWR1bGVEYXRhKTtcclxuICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ3RleHQvY3N2Jyk7XHJcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtRGlzcG9zaXRpb24nLCAnYXR0YWNobWVudDsgZmlsZW5hbWU9XCJlbmhhbmNlZC1zY2hlZHVsZS5jc3ZcIicpO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoY3N2KTtcclxuICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAneGxzeCcpIHtcclxuICAgICAgLy8gRm9yIG5vdywgcmV0dXJuIENTViBkYXRhIHdpdGggeGxzeCBjb250ZW50IHR5cGUgYXMgYSB3b3JrYXJvdW5kXHJcbiAgICAgIGNvbnN0IGNzdiA9IGdlbmVyYXRlQ1NWKHNjaGVkdWxlRGF0YSk7XHJcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCcpO1xyXG4gICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LURpc3Bvc2l0aW9uJywgJ2F0dGFjaG1lbnQ7IGZpbGVuYW1lPVwiZW5oYW5jZWQtc2NoZWR1bGUueGxzeFwiJyk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZChjc3YpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXHJcbiAgICAgICAgZXJyb3I6ICdVbnN1cHBvcnRlZCBmb3JtYXQnLFxyXG4gICAgICAgIGRldGFpbHM6ICdTdXBwb3J0ZWQgZm9ybWF0czogY3N2LCBqc29uLCB4bHN4J1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0VuaGFuY2VkIHNjaGVkdWxlIGdlbmVyYXRpb24gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgIGVycm9yOiAnRW5oYW5jZWQgc2NoZWR1bGUgZ2VuZXJhdGlvbiBmYWlsZWQnLFxyXG4gICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbImdlbmVyYXRlRW5oYW5jZWRTY2hlZHVsZSIsImVuZ2luZWVycyIsInN0YXJ0RGF0ZSIsIndlZWtzIiwic2VlZHMiLCJsZWF2ZSIsInNjaGVkdWxlIiwiZGVjaXNpb25Mb2ciLCJyb2xlcyIsIndlZWtlbmRBc3NpZ25tZW50Q2FjaGUiLCJsZWF2ZU1hcCIsImZvckVhY2giLCJlbmciLCJTZXQiLCJlbnRyeSIsImVuZ2luZWVyIiwiYWRkIiwiZGF0ZSIsInN0YXJ0RGF0ZU9iaiIsIkRhdGUiLCJpbmNsdWRlc1ByZXZpb3VzU2F0dXJkYXkiLCJnZXREYXkiLCJhbGxEYXRlcyIsInByZXZpb3VzU2F0dXJkYXkiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInB1c2giLCJ3ZWVrIiwiZGF5IiwiY3VycmVudERhdGUiLCJvbkNhbGxCeVdlZWsiLCJlYXJseUJ5V2VlayIsImRhdGVJbmRleCIsImxlbmd0aCIsImRhdGVTdHIiLCJ0b0lTT1N0cmluZyIsInNwbGl0IiwiZGF5TmFtZXMiLCJkYXlOYW1lIiwiaXNXZWVrZGF5IiwiZGF5c1NpbmNlU3RhcnQiLCJNYXRoIiwiZmxvb3IiLCJnZXRUaW1lIiwiY3VycmVudFdlZWsiLCJleHBlY3RlZFdvcmtpbmciLCJ3ZWVrZW5kV2VlayIsIm5leHREYXkiLCJkYXlzU2luY2VTdW5kYXlTdGFydCIsImludGVuZGVkRW5naW5lZXIiLCJpbnRlbmRlZEVuZ2luZWVySWR4Iiwid2Vla2VuZCIsInByZXZpb3VzV2Vla2VuZEVuZ2luZWVyIiwicHJldmlvdXNXZWVrIiwicHJldmlvdXNPbkNhbGwiLCJleGNsdXNpb25zIiwiZXhjbHVzaW9uUmVhc29ucyIsImluY2x1ZGVzIiwiaSIsIm5leHRJZHgiLCJuZXh0RW5naW5lZXIiLCJoYXNDb25zZWN1dGl2ZVdlZWtlbmRDb25mbGljdCIsImhhc09uQ2FsbENvbmZsaWN0IiwiZGVjaXNpb25fdHlwZSIsImFmZmVjdGVkX2VuZ2luZWVycyIsInJlYXNvbiIsImpvaW4iLCJhbHRlcm5hdGl2ZXNfY29uc2lkZXJlZCIsInRpbWVzdGFtcCIsIm9uTGVhdmVUb2RheSIsImZpbHRlciIsImhhcyIsImF2YWlsYWJsZSIsImluaXRpYWxXb3JraW5nIiwid29ya2luZyIsIm1pblJlcXVpcmVkIiwiYmFja2ZpbGxDYW5kaWRhdGVzIiwibmVlZGVkIiwibWluIiwic2VsZWN0ZWQiLCJzbGljZSIsImRheVNjaGVkdWxlIiwiRGF5IiwiV2Vla2VuZCIsIkNoYXQiLCJPbkNhbGwiLCJBcHBvaW50bWVudHMiLCJFYXJseSIsIndlZWtlbmRFbmdpbmVlciIsImRheU9mZnNldCIsIm9uQ2FsbEVuZ2luZWVyIiwiaW50ZW5kZWRPbkNhbGxJZHgiLCJvbmNhbGwiLCJpbnRlbmRlZE9uQ2FsbCIsInByZXZpb3VzV2Vla2VuZCIsInByZXZpb3VzV2Vla2VuZFN1bmRheSIsInByZXZpb3VzV2Vla2VuZFN1bmRheVN0ciIsImN1cnJlbnRXZWVrZW5kU3VuZGF5IiwiY3VycmVudFdlZWtlbmRTdW5kYXlTdHIiLCJjdXJyZW50V2Vla2VuZEVuZ2luZWVyIiwiaGFzV2Vla2VuZENvbmZsaWN0IiwiaGFzUHJldmlvdXNXZWVrZW5kQ29uZmxpY3QiLCJoYXNDdXJyZW50V2Vla2VuZENvbmZsaWN0IiwiY29uZmxpY3RFbmdpbmVlciIsImNvbmZsaWN0UmVhc29uIiwiZWFybHlFbmdpbmVlciIsImVhcmx5Iiwibm9uT25DYWxsRW5naW5lZXJzIiwiY2hhdCIsImFwcG9pbnRtZW50cyIsImFzc2lnbmVkUm9sZXMiLCJPYmplY3QiLCJlbnRyaWVzIiwia2V5IiwidmFsdWUiLCJtYXAiLCJyb2xlIiwidmFsdWVzIiwidiIsImVuZ2luZWVyU3RhdHMiLCJhc3NpZ25tZW50cyIsInRvdGFsQXNzaWdubWVudHMiLCJtZXRhZGF0YSIsImxlYXZlRW50cmllcyIsImdlbmVyYXRlZEF0IiwiZmFpcm5lc3NSZXBvcnQiLCJsZWF2ZUltcGFjdCIsImdlbmVyYXRlQ1NWIiwiZGF0YSIsImhlYWRlcnMiLCJrZXlzIiwiY3N2Iiwicm93IiwiaGVhZGVyIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInN0YXJ0X3N1bmRheSIsImZvcm1hdCIsImJvZHkiLCJBcnJheSIsImlzQXJyYXkiLCJkZXRhaWxzIiwiZGVmYXVsdFNlZWRzIiwiZmluYWxTZWVkcyIsInNjaGVkdWxlRGF0YSIsInNldEhlYWRlciIsInNlbmQiLCJjb25zb2xlIiwiRXJyb3IiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/generate.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cgenerate.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();